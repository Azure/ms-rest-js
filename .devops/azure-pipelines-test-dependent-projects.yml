jobs:
- job: prepare_ms_rest_js
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - script: 'npm pack'
    displayName: 'npm pack'
  - script: 'mv azure-ms-rest-js-*.tgz azure-ms-rest-js.tgz'
    displayName: 'mv azure-ms-rest-js-*.tgz azure-ms-rest-js.tgz'
  - script: 'ls -a'
    displayName: "ls -a"
  - task: PublishPipelineArtifact@0
    inputs:
      artifactName: 'ms-rest-js'
      targetPath: 'azure-ms-rest-js.tgz'

- job: clone_dependent_projects
  dependsOn: prepare_ms_rest_js
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - task: DownloadPipelineArtifact@0
    inputs:
      artifactName: 'ms-rest-js'
      targetPath: $(System.DefaultWorkingDirectory)
  - script: 'mkdir ../tmp'
    displayName: 'mkdir ../tmp'
  - script: 'git clone https://github.com/Azure/ms-rest-azure-js.git ms-rest-azure-js --depth 1'
    workingDirectory: '../tmp'
    displayName: "clone ms-rest-azure-js"
  - script: 'npm install --verbose'
    workingDirectory: '../tmp/ms-rest-azure-js'
    displayName: "npm install"
  - script: 'ls -a'
    displayName: "ls -a"
  - script: 'npm install azure-ms-rest-js.tgz'
    workingDirectory: '../tmp/ms-rest-azure-js'
    displayName: "npm install azure-ms-rest-js.tgz"
  - script: 'cat package.json'
    workingDirectory: '../tmp/ms-rest-azure-js'
    displayName: "cat package.json"
  - script: 'ls -a'
    displayName: "ls -a"
  - script: 'npm run test'
    workingDirectory: '../tmp/ms-rest-azure-js'
    displayName: "npm run test @ ms-rest-azure-js"
