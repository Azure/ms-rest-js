jobs:
- job: prepare_ms_rest_js
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - script: 'npm install'
    displayName: 'npm install'
  - script: 'npm run build'
    displayName: 'npm run build'
  - script: 'npm run test'
    displayName: 'npm run test'
  - script: 'ls -a'
    displayName: "ls -a"
  - task: CopyFiles@2
    displayName: 'Copy Files to: $(Build.StagingDirectory)'
    inputs:
      Contents: '*.*'
      TargetFolder: '$(Build.ArtifactStagingDirectory)/ms-rest-js'

- job: clone_dependent_projects
  dependsOn: prepare_ms_rest_js
  pool:
    vmImage: 'Ubuntu 16.04'
  steps:
  - script: 'mkdir ../tmp'
    displayName: 'mkdir ../tmp'
  - script: 'git clone https://github.com/Azure/ms-rest-azure-js.git ms-rest-azure-js --depth 1'
    workingDirectory: '../tmp'
    displayName: "clone ms-rest-azure-js"
  - script: 'npm install --verbose'
    workingDirectory: '../tmp/ms-rest-azure-js'
    displayName: "npm install"
  - script: 'npm install $(Build.ArtifactStagingDirectory)/ms-rest-js'
    workingDirectory: '../tmp/ms-rest-azure-js'
    displayName: "npm install $(Build.ArtifactStagingDirectory)/ms-rest-js"
  - script: 'cat package.json'
    workingDirectory: '../tmp/ms-rest-azure-js'
    displayName: "cat package.json"
  - script: 'ls -a'
    displayName: "ls -a"
  - script: 'npm run test'
    workingDirectory: '../tmp/ms-rest-azure-js'
    displayName: "npm run test @ ms-rest-azure-js"
